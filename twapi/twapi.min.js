(function(k){function P(){function O(){h("https://api.twitch.tv/kraken/streams/"+c+"?client_id="+d+"&api_version=3",function(a){a.stream?(v=!0,A=a.stream.viewers,E=a.stream.average_fps,F=a.stream.video_height,G=a.stream.delay):v=!1});h("https://api.twitch.tv/kraken/channels/"+c+"?client_id="+d+"&api_version=3",function(a){x=a.game;y=a.status;k=a.followers;H=a.views;B=a.partner;I=a.created_at;J=a.logo;K=a.video_banner;L=a.profile_banner});h("https://api.twitch.tv/kraken/channels/"+c+"/follows?client_id="+
d+"&api_version=3&limit=100",function(a){if(a.follows){var b=!0;0<C.length&&(b=!1);for(var c=0;c<a.follows.length;c++){var N=a.follows[c].user.display_name;-1===C.indexOf(N)&&(b||r("twapiFollow",N),C.push(N))}}});h("https://tmi.twitch.tv/group/user/"+c+"/chatters?client_id="+d+"&api_version=3",function(a){if(!a.data.chatters)return console.log("No response for user list.");A=a.data.chatter_count;w.moderators=a.data.chatters.moderators.slice();w.staff=a.data.chatters.staff.slice();w.admins=a.data.chatters.admins.slice();
w.global_mods=a.data.chatters.global_mods.slice();w.viewers=a.data.chatters.viewers.slice()});setTimeout(function(){document.querySelector("#twapiJsonpContainer").innerHTML="";O()},1E4)}function Q(a){h("https://api.twitch.tv/kraken/chat/"+c+"/badges?api_version=3",function(b){null!=b.subscriber&&(M=b.subscriber.image);a&&a()})}var b={},d="",z="",D="",c="",m,v=!1,x="",y="",k="",H="",B="",A="",E="",F="",G="",M="",w={},C=[],I="",J="",K="",L="";b.setup=function(a,b,c){a&&b||console.error("Invalid parameters. Usage: TWAPI.setup(clientid, oauth, callback);");
d=a;z=b;a=document.createElement("div");a.id="twapiJsonpContainer";a.style.cssText="display:none;";document.querySelectorAll("body")[0].appendChild(a);h("https://api.twitch.tv/kraken?client_id="+d+"&oauth_token="+z+"&api_version=3",function(a){D=a.token.user_name;c&&c(D)})};b.runChat=function(a,q){D&&z||console.error("TWAPI not set up, cannot run chat.");m&&b.closeChat();c=a.toLowerCase();h("https://api.twitch.tv/api/channels/"+c+"/chat_properties?api_version=3",function(a){m=new WebSocket("ws://"+
a.web_socket_servers[Math.floor(Math.random()*a.web_socket_servers.length)]);m.onopen=function(a){m.send("CAP REQ :twitch.tv/tags twitch.tv/commands twitch.tv/membership");m.send("PASS oauth:"+z);m.send("NICK "+D);m.send("JOIN #"+c)};m.onmessage=function(a){a=a.data.split("\r\n");for(var b=0;b<a.length;b++){var f=a[b];if("PING :tmi.twitch.tv"===f)m.send("PONG :tmi.twitch.tv");else if(f){r("twapiRaw",f);var e=f.split(" ");if("PRIVMSG"===e[2]){f=e[0];e.splice(0,1);for(var g=e,q=f.split(";"),f="#d2691e",
d=e=!1,k=!1,h="",p="",l=0;l<q.length;l++){q[l]=q[l].split("=");var t=q[l][0],n=q[l][1];"display-name"===t?h=""===n?g[0].split("!")[0].substring(1):n:"@color"===t&&""!=n?f=n:"mod"===t&&"1"==n?e=!0:"subscriber"===t&&"1"==n?d=!0:"turbo"===t&&"1"==n?k=!0:"emotes"===t&&""!=n&&(p=n)}q=!1;l=g[3].substring(1);g.splice(0,4);g=g.join(" ");"\u0001ACTION"===l?(l=g,q=!0):l+=" "+g;g=l.replace(/</g,"&lt;").replace(/>/g,"&gt;");r("twapiMsg",{from:h,color:f,mod:e,sub:d,turbo:k,streamer:h.toLowerCase()===c.toLowerCase(),
action:q,text:g,emotes:p})}else if("PRIVMSG"===e[1])r("twapiHost",e[3].substring(1));else if("NOTICE"===e[2])e.splice(0,4),f=e.join(" ").substring(1),r("twapiNotice",f);else if("JOIN"===e[1])f=e[0].split("!")[0].substring(1),r("twapiJoin",f);else if("PART"===e[1])f=e[0].split("!")[0].substring(1),r("twapiPart",f);else if("ROOMSTATE"===e[2]){p=e[0].substring(1).split(";");h=k=d=e=f=void 0;for(h in p)p=h.split("="),"broadcaster-lang"===p[0]?f=p[1]:"r9k"===p[0]?e=p[1]:"slow"===p[0]?d=p[1]:"subs-only"===
p[0]&&(k=p[1]);r("twapiRoomstate",{lang:f,r9k:e,slow:d,subs_only:k})}else if("WHISPER"===e[2]){f=e;e="#d2691e";d="";k=!1;q=g=p=h="";l=f[0].split(";");for(t=0;t<l.length;t++){l[t]=l[t].split("=");var n=l[t][0],u=l[t][1];"display-name"===n?h=""===u?f[1].split("!")[0].substring(1):u:"@color"===n&&""!=u?e=u:"turbo"===n&&"1"==u?k=!0:"emotes"===n&&""!=u?d=u:"message-id"===n&&""!=u?p=u:"thread-id"===n&&""!=u?g=u:"user-id"===n&&""!=u&&(q=u)}l=f.slice(4).join(" ").substring(1);r("twapiWhisper",{from:h,to:f[3],
color:e,emotes:d,turbo:k,message_id:p,thread_id:g,user_id:q,text:l})}else"CLEARCHAT"===e[1]&&(4===e.length?(f=e[3].substring(1),r("twapiClearUser",f)):r("twapiClearChat"))}}};Q(function(){O();q&&setTimeout(q,500)})})};b.closeChat=function(){if(!m)return console.error("Chat is not open.");m.close();console.log("Chat closed.");m=c="";v=!1;M=G=F=E=A=B=H=k=y=x="";w={};C=[];L=K=J=I=""};b.changeChannel=function(a){if(!m)return console.error("Chat is not open.");m.send("PART #"+c);c=a;v=!1;M=G=F=E=A=B=H=
k=y=x="";w={};C=[];L=K=J=I="";m.send("JOIN #"+c)};b.sendChat=function(a){if(!m)return console.error("Chat is not open.");m.send("PRIVMSG #"+c+" :"+a)};b.sendWhisper=function(a,b){if(!m)return console.error("Chat is not open.");m.send("PRIVMSG #jtv :/w "+a+" "+b)};b.getUsername=function(){return D};b.getChannel=function(){return c};b.isOnline=function(){return c?v:console.error("Not in a channel.")};b.getStatus=function(){return c?y:console.error("Not in a channel.")};b.getGame=function(){return c?
x:console.error("Not in a channel.")};b.getFollowerCount=function(){return c?k:console.error("Not in a channel.")};b.getTotalViewCount=function(){return c?H:console.error("Not in a channel.")};b.isPartner=function(){return c?B:console.error("Not in a channel.")};b.getCurrentViewCount=function(){return c?A:console.error("Not in a channel.")};b.getFps=function(){return v?E:console.error("Stream not online.")};b.getVideoHeight=function(){return v?F:console.error("Stream not online.")};b.getDelay=function(){return v?
G:console.error("Stream not online.")};b.getSubBadgeUrl=function(){return c?M:console.error("Not in a channel.")};b.getChatters=function(){return c?w:console.error("Not in a channel.")};b.getCreatedAt=function(){return c?I:console.error("Not in a channel.")};b.getLogo=function(){return c?J:console.error("Not in a channel.")};b.getVideoBanner=function(){return c?K:console.error("Not in a channel.")};b.getProfileBanner=function(){return c?L:console.error("Not in a channel.")};b.isFollowing=function(a,
b,c){h("https://api.twitch.tv/kraken/users/"+a+"/follows/channels/"+b+"?api_version=3&client_id="+d,function(a){a.error?c({isFollowing:!1}):c({isFollowing:!0,dateFollowed:(new Date(a.created_at)).toLocaleString()})})};b.isSubscribing=function(a,b,c){h("https://api.twitch.tv/kraken/channels/"+b+"/subscriptions/"+a+"?api_version=3client_id="+d,function(a){a.error?c({isSubscribing:!1}):c({isSubscribing:!0,dateSubscribed:(new Date(a.created_at)).toLocaleString()})})};b.runCommercial=function(a){B||console.error("Not a partner, cannot run a commercial.");
c||console.error("Not in a channel.");a||(a=30);var b="https://api.twitch.tv/kraken/channels/"+c+"/commercial",b=b+("?oauth_token="+z),g=new XMLHttpRequest;g.open("POST",b,!0);g.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");g.send("length="+a)};b.setStatusGame=function(a,b){a||(a=y);b||(b=x);var g="https://api.twitch.tv/kraken/channels/"+c,g=g+("?channel[status]="+encodeURIComponent(a)),g=g+("&channel[game]="+encodeURIComponent(b)),g=g+("&_method=put&oauth_token="+
z),d=new XMLHttpRequest;d.open("GET",g,!0);d.onload=function(){if(200<=d.status&&400>d.status){var a=JSON.parse(d.responseText);x=a.game;y=a.status}else console.error(d.responseText)};d.onerror=function(){console.error(d.responseText)};d.send()};return b}function r(h,k){var b=new CustomEvent(h,{detail:k});document.dispatchEvent(b)}function h(h,r){var b;do b="jsonp"+Math.floor(1E6*Math.random());while(k[b]);k[b]=function(d){r(d);delete k[b]};var d=document.createElement("script");d.src=h+"&callback="+
b;document.querySelector("#twapiJsonpContainer").appendChild(d)}"undefined"===typeof TWAPI?k.TWAPI=P():console.error("TWAPI already defined.")})(window);
