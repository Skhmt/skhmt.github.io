(function(){function E(){function E(){w("https://api.twitch.tv/kraken/streams/"+c+"?client_id="+x+"&api_version=3",function(a){a.stream?(y=!0,F=a.stream.viewers,J=a.stream.average_fps,K=a.stream.video_height,L=a.stream.delay):y=!1});w("https://api.twitch.tv/kraken/channels/"+c+"?client_id="+x+"&api_version=3",function(a){A=a.game;B=a.status;M=a.followers;N=a.views;G=a.partner;O=a.created_at;P=a.logo;Q=a.video_banner;R=a.profile_banner});w("https://api.twitch.tv/kraken/channels/"+c+"/follows?client_id="+
x+"&api_version=3&limit=100",function(a){if(a.follows){var b=!0;0<H.length&&(b=!1);for(var d=0;d<a.follows.length;d++){var c=a.follows[d].user.display_name;-1===H.indexOf(c)&&(b||r("follow",c),H.push(c))}}});w("https://tmi.twitch.tv/group/user/"+c+"/chatters?client_id="+x+"&api_version=3",function(a){t||(a=a.data);if(!a.chatters)return console.log("No response for user list.");F=a.chatter_count;z.moderators=a.chatters.moderators.slice();z.staff=a.chatters.staff.slice();z.admins=a.chatters.admins.slice();
z.global_mods=a.chatters.global_mods.slice();z.viewers=a.chatters.viewers.slice()});setTimeout(function(){t||(document.querySelector("#twapiJsonpContainer").innerHTML="");E()},1E4)}function aa(a){w("https://api.twitch.tv/kraken/chat/"+c+"/badges?api_version=3",function(c){c.subscriber&&(S=c.subscriber.image);a&&a()})}function r(a,c){if(C.has(a))for(var b=C.get(a),f=0;f<b.length;f++)b[f](c)}function w(a,c){if(t)require("https").get(a,function(a){var b="";a.setEncoding("utf8");a.on("data",function(a){b+=
a});a.on("end",function(){200<=a.statusCode&&400>a.statusCode?c(JSON.parse(b)):console.error(b)})}).on("error",function(a){console.error(a.message)});else{var b;do b="jsonp"+Math.floor(1E6*Math.random());while(window[b]);window[b]=function(a){c(a);delete window[b]};var f=document.createElement("script");f.src=a+"&callback="+b;document.querySelector("#twapiJsonpContainer").appendChild(f)}}var b={},x="",D="",I="",c="",k,y=!1,A="",B="",M="",N="",G="",F="",J="",K="",L="",S="",z={},H=[],O="",P="",Q="",
R="",t=!1,C=new Map,X="",Y="",Z="",T="",U="",V="",W="";"undefined"!==typeof module&&"undefined"!==typeof module.exports&&(t=!0);b.setup=function(a,b,c){a&&b||console.error("Invalid parameters. Usage: TWAPI.setup(clientid, oauth[, callback]);");x=a;D=b;t||(a=document.createElement("div"),a.id="twapiJsonpContainer",a.style.cssText="display:none;",document.getElementsByTagName("body")[0].appendChild(a));w("https://api.twitch.tv/kraken?client_id="+x+"&oauth_token="+D+"&api_version=3",function(a){I=a.token.user_name;
c&&c(I)})};b.runChat=function(a,q){function d(){k.send("CAP REQ :twitch.tv/tags twitch.tv/commands twitch.tv/membership");k.send("PASS oauth:"+D);k.send("NICK "+I);k.send("JOIN #"+c)}function f(a){a=t?a.split("\r\n"):a.data.split("\r\n");for(var b=0;b<a.length;b++){var g=a[b];if("PING :tmi.twitch.tv"===g)k.send("PONG :tmi.twitch.tv");else if(g){r("raw",g);var e=g.split(" ");if("PRIVMSG"===e[2]){g=e[0];e.splice(0,1);for(var d=e,f=g.split(";"),g="#d2691e",h=e=!1,q=!1,u="",v="",l=0;l<f.length;l++){f[l]=
f[l].split("=");var n=f[l][0],m=f[l][1];"display-name"===n?u=""===m?d[0].split("!")[0].substring(1):m:"@color"===n&&""!==m?g=m:"mod"===n&&"1"==m?e=!0:"subscriber"===n&&"1"==m?h=!0:"turbo"===n&&"1"==m?q=!0:"emotes"===n&&""!==m&&(v=m)}f=!1;l=d[3].substring(1);d.splice(0,4);d=d.join(" ");"\u0001ACTION"===l?(l=d,f=!0):l+=" "+d;d=l.replace(/</g,"&lt;").replace(/>/g,"&gt;");r("message",{from:u,color:g,mod:e,sub:h,turbo:q,streamer:u.toLowerCase()===c.toLowerCase(),action:f,text:d,emotes:v})}else if("PRIVMSG"===
e[1])r("host",e[3].substring(1));else if("NOTICE"===e[2])e.splice(0,4),g=e.join(" ").substring(1),r("notice",g);else if("JOIN"===e[1])g=e[0].split("!")[0].substring(1),r("join",g);else if("PART"===e[1])g=e[0].split("!")[0].substring(1),r("part",g);else if("ROOMSTATE"===e[2]){g=e[0].substring(1).split(";");u=q=h=e=void 0;for(v=0;v<g.length;v++)d=g[v].split("="),"broadcaster-lang"===d[0]?e=d[1]:"r9k"===d[0]?h=d[1]:"slow"===d[0]?q=d[1]:"subs-only"===d[0]&&(u=d[1]);r("roomstate",{lang:e,r9k:h,slow:q,
subs_only:u})}else if("WHISPER"===e[2]){g=e;e="#d2691e";h="";q=!1;f=d=v=u="";l=g[0].split(";");for(n=0;n<l.length;n++){l[n]=l[n].split("=");var m=l[n][0],p=l[n][1];"display-name"===m?u=""===p?g[1].split("!")[0].substring(1):p:"@color"===m&&""!==p?e=p:"turbo"===m&&"1"==p?q=!0:"emotes"===m&&""!==p?h=p:"message-id"===m&&""!==p?v=p:"thread-id"===m&&""!==p?d=p:"user-id"===m&&""!==p&&(f=p)}l=g.slice(4).join(" ").substring(1);r("whisper",{from:u,to:g[3],color:e,emotes:h,turbo:q,message_id:v,thread_id:d,
user_id:f,text:l})}else if("CLEARCHAT"===e[1])4===e.length?(g=e[3].substring(1),r("clearUser",g)):r("clearChat");else if("USERSTATE"===e[2])for(g=e[0].substring(1).split(";"),e=0;e<g.length;e++)h=g[e].split("="),"color"===h[0]?Y=h[1]:"display-name"===h[0]?X=h[1]:"emote-sets"===h[0]?Z=h[1]:"mod"===h[0]?T=h[1]:"subscriber"===h[0]?U=h[1]:"turbo"===h[0]?V=h[1]:"user-type"===h[0]&&(W=h[1])}}}I&&D||console.error("TWAPI not set up, cannot run chat.");k&&b.closeChat();c=a.toLowerCase();k=t?new (require("ws"))("ws://irc-ws.chat.twitch.tv:80"):
new WebSocket("ws://irc-ws.chat.twitch.tv:80");t?(k.on("open",d),k.on("message",f)):(k.onopen=d,k.onmessage=f);aa(function(){E();q&&setTimeout(q,500)})};b.closeChat=function(){if(!k)return console.error("Chat is not open.");k.close();console.log("Chat closed.");k=c="";y=!1;S=L=K=J=F=G=N=M=B=A="";z={};H=[];W=V=U=T=Z=Y=X=R=Q=P=O=""};b.changeChannel=function(a){if(!k)return console.error("Chat is not open.");k.send("PART #"+c);c=a;y=!1;S=L=K=J=F=G=N=M=B=A="";z={};H=[];W=V=U=T=R=Q=P=O="";k.send("JOIN #"+
c)};b.sendChat=function(a){if(!k)return console.error("Chat is not open.");k.send("PRIVMSG #"+c+" :"+a)};b.sendWhisper=function(a,b){if(!k)return console.error("Chat is not open.");k.send("PRIVMSG #jtv :/w "+a+" "+b)};b.getUsername=function(){return I};b.getChannel=function(){return c};b.isOnline=function(){return c?y:console.error("Not in a channel.")};b.getStatus=function(){return c?B:console.error("Not in a channel.")};b.getGame=function(){return c?A:console.error("Not in a channel.")};b.getFollowerCount=
function(){return c?M:console.error("Not in a channel.")};b.getTotalViewCount=function(){return c?N:console.error("Not in a channel.")};b.isPartner=function(){return c?G:console.error("Not in a channel.")};b.getCurrentViewCount=function(){return c?F:console.error("Not in a channel.")};b.getFps=function(){return y?J:console.error("Stream not online.")};b.getVideoHeight=function(){return y?K:console.error("Stream not online.")};b.getDelay=function(){return y?L:console.error("Stream not online.")};b.getSubBadgeUrl=
function(){return c?S:console.error("Not in a channel.")};b.getChatters=function(){return c?z:console.error("Not in a channel.")};b.getCreatedAt=function(){return c?O:console.error("Not in a channel.")};b.getLogo=function(){return c?P:console.error("Not in a channel.")};b.getVideoBanner=function(){return c?Q:console.error("Not in a channel.")};b.getProfileBanner=function(){return c?R:console.error("Not in a channel.")};b.getDisplayName=function(){return c?X:console.error("Not in a channel.")};b.getColor=
function(){return c?Y:console.error("Not in a channel.")};b.getEmoteSets=function(){return c?Z:console.error("Not in a channel.")};b.getMod=function(){return c?T:console.error("Not in a channel.")};b.getSub=function(){return c?U:console.error("Not in a channel.")};b.getTurbo=function(){return c?V:console.error("Not in a channel.")};b.getUserType=function(){return c?W:console.error("Not in a channel.")};b.isFollowing=function(a,b,c){w("https://api.twitch.tv/kraken/users/"+a+"/follows/channels/"+b+
"?api_version=3&client_id="+x,function(a){a.error?c({isFollowing:!1}):c({isFollowing:!0,dateFollowed:(new Date(a.created_at)).toLocaleString()})})};b.isSubscribing=function(a,b,c){w("https://api.twitch.tv/kraken/channels/"+b+"/subscriptions/"+a+"?api_version=3client_id="+x,function(a){a.error?c({isSubscribing:!1}):c({isSubscribing:!0,dateSubscribed:(new Date(a.created_at)).toLocaleString()})})};b.runCommercial=function(a){G||console.error("Not a partner, cannot run a commercial.");c||console.error("Not in a channel.");
a||(a=30);var b="/kraken/channels/"+c+"/commercial?oauth_token="+D,d="https://api.twitch.tv"+b;t?(d={host:"https://api.twitch.tv",path:b,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}},require("https").request(d).write("length="+a).end()):(b=new XMLHttpRequest,b.open("POST",d,!0),b.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),b.send("length="+a))};b.setStatusGame=function(a,b){a||(a=B);b||(b=A);var d="https://api.twitch.tv/kraken/channels/"+
c,d=d+("?channel[status]="+encodeURIComponent(a)),d=d+("&channel[game]="+encodeURIComponent(b)),d=d+("&_method=put&oauth_token="+D);if(t)require("https").get(d,function(a){var b="";a.setEncoding("utf8");a.on("data",function(a){b+=a});a.on("end",function(){if(200<=a.statusCode&&400>a.statusCode){var c=JSON.parse(b);A=c.game;B=c.status}else console.error(b)})}).on("error",function(a){console.error(a.message)});else{var f=new XMLHttpRequest;f.open("GET",d,!0);f.onload=function(){if(200<=f.status&&400>
f.status){var a=JSON.parse(f.responseText);A=a.game;B=a.status}else console.error(f.responseText)};f.onerror=function(){console.error(f.responseText)};f.send()}};b.listen=function(a,b){if(C.has(a)){var c=C.get(a);c.push(b);C.set(a,c)}else C.set(a,[b])};return b}"undefined"!==typeof module&&"undefined"!==typeof module.exports?module.exports=E():"undefined"===typeof TWAPI?window.TWAPI=E():console.error("TWAPI already defined.")})();
