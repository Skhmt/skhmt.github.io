(function(k){function P(){function O(){h("https://api.twitch.tv/kraken/streams/"+c+"?client_id="+d+"&api_version=3",function(a){a.stream?(v=!0,A=a.stream.viewers,E=a.stream.average_fps,F=a.stream.video_height,G=a.stream.delay):v=!1});h("https://api.twitch.tv/kraken/channels/"+c+"?client_id="+d+"&api_version=3",function(a){x=a.game;y=a.status;k=a.followers;H=a.views;B=a.partner;I=a.created_at;J=a.logo;K=a.video_banner;L=a.profile_banner});h("https://api.twitch.tv/kraken/channels/"+c+"/follows?client_id="+
d+"&api_version=3&limit=100",function(a){if(a.follows){var b=!0;0<C.length&&(b=!1);for(var c=0;c<a.follows.length;c++){var N=a.follows[c].user.display_name;-1===C.indexOf(N)&&(b||q("twapiFollow",N),C.push(N))}}});h("https://tmi.twitch.tv/group/user/"+c+"/chatters?client_id="+d+"&api_version=3",function(a){if(!a.data.chatters)return console.log("No response for user list.");A=a.data.chatter_count;w.moderators=a.data.chatters.moderators.slice();w.staff=a.data.chatters.staff.slice();w.admins=a.data.chatters.admins.slice();
w.global_mods=a.data.chatters.global_mods.slice();w.viewers=a.data.chatters.viewers.slice()});setTimeout(function(){document.querySelector("#twapiJsonpContainer").innerHTML="";O()},1E4)}function Q(a){h("https://api.twitch.tv/kraken/chat/"+c+"/badges?api_version=3",function(b){null!=b.subscriber&&(M=b.subscriber.image);a&&a()})}var b={},d="",z="",D="",c="",e,v=!1,x="",y="",k="",H="",B="",A="",E="",F="",G="",M="",w={},C=[],I="",J="",K="",L="";b.setup=function(a,b,c){a&&b||console.error("Invalid parameters. Usage: TWAPI.setup(clientid, oauth, callback);");
d=a;z=b;a=document.createElement("div");a.id="twapiJsonpContainer";a.style.cssText="display:none;";document.querySelectorAll("body")[0].appendChild(a);h("https://api.twitch.tv/kraken?client_id="+d+"&oauth_token="+z+"&api_version=3",function(a){D=a.token.user_name;c&&c(D)})};b.runChat=function(a,p){D&&z||console.error("TWAPI not set up, cannot run chat.");e&&b.closeChat();c=a.toLowerCase();e=new WebSocket("ws://irc-ws.chat.twitch.tv:80");e.onopen=function(a){e.send("CAP REQ :twitch.tv/tags twitch.tv/commands twitch.tv/membership");
e.send("PASS oauth:"+z);e.send("NICK "+D);e.send("JOIN #"+c)};e.onmessage=function(a){a=a.data.split("\r\n");for(var b=0;b<a.length;b++){var g=a[b];if("PING :tmi.twitch.tv"===g)e.send("PONG :tmi.twitch.tv");else if(g){q("twapiRaw",g);var f=g.split(" ");if("PRIVMSG"===f[2]){g=f[0];f.splice(0,1);for(var p=f,d=g.split(";"),g="#d2691e",k=f=!1,h=!1,u="",n="",l=0;l<d.length;l++){d[l]=d[l].split("=");var r=d[l][0],m=d[l][1];"display-name"===r?u=""===m?p[0].split("!")[0].substring(1):m:"@color"===r&&""!=
m?g=m:"mod"===r&&"1"==m?f=!0:"subscriber"===r&&"1"==m?k=!0:"turbo"===r&&"1"==m?h=!0:"emotes"===r&&""!=m&&(n=m)}d=!1;l=p[3].substring(1);p.splice(0,4);p=p.join(" ");"\u0001ACTION"===l?(l=p,d=!0):l+=" "+p;p=l.replace(/</g,"&lt;").replace(/>/g,"&gt;");q("twapiMsg",{from:u,color:g,mod:f,sub:k,turbo:h,streamer:u.toLowerCase()===c.toLowerCase(),action:d,text:p,emotes:n})}else if("PRIVMSG"===f[1])q("twapiHost",f[3].substring(1));else if("NOTICE"===f[2])f.splice(0,4),g=f.join(" ").substring(1),q("twapiNotice",
g);else if("JOIN"===f[1])g=f[0].split("!")[0].substring(1),q("twapiJoin",g);else if("PART"===f[1])g=f[0].split("!")[0].substring(1),q("twapiPart",g);else if("ROOMSTATE"===f[2]){n=f[0].substring(1).split(";");u=h=k=f=g=void 0;for(u in n)n=u.split("="),"broadcaster-lang"===n[0]?g=n[1]:"r9k"===n[0]?f=n[1]:"slow"===n[0]?k=n[1]:"subs-only"===n[0]&&(h=n[1]);q("twapiRoomstate",{lang:g,r9k:f,slow:k,subs_only:h})}else if("WHISPER"===f[2]){g=f;f="#d2691e";k="";h=!1;d=p=n=u="";l=g[0].split(";");for(r=0;r<l.length;r++){l[r]=
l[r].split("=");var m=l[r][0],t=l[r][1];"display-name"===m?u=""===t?g[1].split("!")[0].substring(1):t:"@color"===m&&""!=t?f=t:"turbo"===m&&"1"==t?h=!0:"emotes"===m&&""!=t?k=t:"message-id"===m&&""!=t?n=t:"thread-id"===m&&""!=t?p=t:"user-id"===m&&""!=t&&(d=t)}l=g.slice(4).join(" ").substring(1);q("twapiWhisper",{from:u,to:g[3],color:f,emotes:k,turbo:h,message_id:n,thread_id:p,user_id:d,text:l})}else"CLEARCHAT"===f[1]&&(4===f.length?(g=f[3].substring(1),q("twapiClearUser",g)):q("twapiClearChat"))}}};
Q(function(){O();p&&setTimeout(p,500)})};b.closeChat=function(){if(!e)return console.error("Chat is not open.");e.close();console.log("Chat closed.");e=c="";v=!1;M=G=F=E=A=B=H=k=y=x="";w={};C=[];L=K=J=I=""};b.changeChannel=function(a){if(!e)return console.error("Chat is not open.");e.send("PART #"+c);c=a;v=!1;M=G=F=E=A=B=H=k=y=x="";w={};C=[];L=K=J=I="";e.send("JOIN #"+c)};b.sendChat=function(a){if(!e)return console.error("Chat is not open.");e.send("PRIVMSG #"+c+" :"+a)};b.sendWhisper=function(a,
b){if(!e)return console.error("Chat is not open.");e.send("PRIVMSG #jtv :/w "+a+" "+b)};b.getUsername=function(){return D};b.getChannel=function(){return c};b.isOnline=function(){return c?v:console.error("Not in a channel.")};b.getStatus=function(){return c?y:console.error("Not in a channel.")};b.getGame=function(){return c?x:console.error("Not in a channel.")};b.getFollowerCount=function(){return c?k:console.error("Not in a channel.")};b.getTotalViewCount=function(){return c?H:console.error("Not in a channel.")};
b.isPartner=function(){return c?B:console.error("Not in a channel.")};b.getCurrentViewCount=function(){return c?A:console.error("Not in a channel.")};b.getFps=function(){return v?E:console.error("Stream not online.")};b.getVideoHeight=function(){return v?F:console.error("Stream not online.")};b.getDelay=function(){return v?G:console.error("Stream not online.")};b.getSubBadgeUrl=function(){return c?M:console.error("Not in a channel.")};b.getChatters=function(){return c?w:console.error("Not in a channel.")};
b.getCreatedAt=function(){return c?I:console.error("Not in a channel.")};b.getLogo=function(){return c?J:console.error("Not in a channel.")};b.getVideoBanner=function(){return c?K:console.error("Not in a channel.")};b.getProfileBanner=function(){return c?L:console.error("Not in a channel.")};b.isFollowing=function(a,b,c){h("https://api.twitch.tv/kraken/users/"+a+"/follows/channels/"+b+"?api_version=3&client_id="+d,function(a){a.error?c({isFollowing:!1}):c({isFollowing:!0,dateFollowed:(new Date(a.created_at)).toLocaleString()})})};
b.isSubscribing=function(a,b,c){h("https://api.twitch.tv/kraken/channels/"+b+"/subscriptions/"+a+"?api_version=3client_id="+d,function(a){a.error?c({isSubscribing:!1}):c({isSubscribing:!0,dateSubscribed:(new Date(a.created_at)).toLocaleString()})})};b.runCommercial=function(a){B||console.error("Not a partner, cannot run a commercial.");c||console.error("Not in a channel.");a||(a=30);var b="https://api.twitch.tv/kraken/channels/"+c+"/commercial",b=b+("?oauth_token="+z),d=new XMLHttpRequest;d.open("POST",
b,!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");d.send("length="+a)};b.setStatusGame=function(a,b){a||(a=y);b||(b=x);var d="https://api.twitch.tv/kraken/channels/"+c,d=d+("?channel[status]="+encodeURIComponent(a)),d=d+("&channel[game]="+encodeURIComponent(b)),d=d+("&_method=put&oauth_token="+z),e=new XMLHttpRequest;e.open("GET",d,!0);e.onload=function(){if(200<=e.status&&400>e.status){var a=JSON.parse(e.responseText);x=a.game;y=a.status}else console.error(e.responseText)};
e.onerror=function(){console.error(e.responseText)};e.send()};return b}function q(k,h){var b=new CustomEvent(k,{detail:h});document.dispatchEvent(b)}function h(h,q){var b;do b="jsonp"+Math.floor(1E6*Math.random());while(k[b]);k[b]=function(d){q(d);delete k[b]};var d=document.createElement("script");d.src=h+"&callback="+b;document.querySelector("#twapiJsonpContainer").appendChild(d)}"undefined"===typeof TWAPI?k.TWAPI=P():console.error("TWAPI already defined.")})(window);
